---

- name: Install base packages
  apt: name={{ item }} state=present
  with_items:
    - bash-completion
    - python3-dev
    - python3-pip
  tags:
    - jupyterlab
- name: Upgrade pip
  pip: name=pip state=latest executable=pip3
  tags:
    - jupyterlab
- name: Installing Jupyterlab
  pip:
    name: jupyterlab
    executable: pip3
- name: Create service 
  become: yes
  become_user: root
  template:
    src: jupyterlab.j2
    dest: /etc/systemd/system/jupyterlab.service
    owner: "{{ remote_user }}"
- name: Start jupyter service
  systemd:
    name: jupyterlab.service
    daemon_reload: yes
    enabled: yes
    state: started
  become: yes
  become_user: root
  tags: jupyterlab

- name: Adding enabled site
  template:
    src: nginx_proxy.j2
    dest: /etc/nginx/sites-available/lab
  become: yes
  become_user: root
#- name: ansible create directory example
#  file:
#    path: /etc/nginx/sites-enabled
#    state: directory

- name: Soft Link
  file:
    src: /etc/nginx/sites-available/lab
    dest: /etc/nginx/sites-enabled/lab
    state: link
  become: yes
  become_user: root
- name: restart nginx
  service:
      name: nginx
      state: restarted
  become: yes
  become_user: root
